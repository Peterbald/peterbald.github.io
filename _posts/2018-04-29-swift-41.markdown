---
layout: post
title: "Swift 4.1 æ›´æ–°æŒ‡åŒ—(è¯‘)"
subtitle: ''
author: "RandomJ"
header-img: "img/background.jpeg"
tags:
  - Swift
  - iOS
---

#### ä¸€ã€æ¦‚è¿°

`Swift 4.1` æ˜¯ `Swift 4` çš„ç¬¬ä¸€ä¸ªå°ç‰ˆæœ¬æ›´æ–°ï¼Œä¸»è¦åŒ…æ‹¬ä¸€äº›å¾ˆå®ç”¨çš„æ”¹è¿›ï¼Œä¾‹å¦‚ï¼Œè‡ªåŠ¨åˆæˆ `Equatable` å’Œ `Hashable`ï¼Œåè®®æ¡ä»¶çº¦æŸï¼Œæ£€æµ‹æ¨¡æ‹Ÿå™¨ç¯å¢ƒç­‰ç­‰ã€‚[ä¾‹å­å·¥ç¨‹åœ°å€](https://www.hackingwithswift.com/articles/70/learn-whats-new-in-swift-4-1-with-a-playground)

#### äºŒã€è‡ªåŠ¨åˆæˆ Equatable å’Œ Hashable

`Equatable` åè®®å…è®¸ `Swfit` ä¸­ç›¸åŒç±»å‹çš„ä¸¤ä¸ªå®ä¾‹ä¹‹å‰çš„æ¯”è¾ƒã€‚å½“æˆ‘ä»¬å†™ `5 == 5` çš„æ—¶å€™ï¼Œ`Swift` ä¹‹æ‰€ä»¥èƒ½å¤Ÿç†è§£æ˜¯å› ä¸º `Int` éµå®ˆ `Equtable` åè®®ï¼Œæ„å‘³ç€å®ƒå®ç°äº†ä¸€ä¸ª `==` å‡½æ•°æè¿°ä¸¤ä¸ª `Int` ä¹‹é—´çš„å…³ç³»ã€‚

ç„¶è€Œï¼Œå®ç° `Equatable`æœ‰ç‚¹è›‹ç–¼ï¼Œçœ‹ä¸‹é¢çš„ä»£ç ï¼š

```swift
struct Person {
    var name: String
}
```

å¦‚æœä½ æœ‰ä¸¤ä¸ª Person å®ä¾‹ï¼Œå¹¶ä¸”æƒ³è¦ç¡®ä¿ä»–ä»¬çš„ä¸€è‡´æ€§ï¼Œéœ€è¦æ¯”è¾ƒä»–ä»¬çš„æ‰€æœ‰å±æ€§ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
```swift
// Swift 4.0 çš„å®ç°
struct Person: Equatable {
    var name: String

    static func ==(lhs: Person, rhs: Person) -> Bool {
        return lhs.name == rhs.name
    }
}
```
```swift
// Swift 4.1 å®ç°
struct Person: Equatable {
    var name: String
}
```
ä¸Šé¢çš„ä»£ç è¯»èµ·æ¥å¾ˆæ¯ç‡¥ï¼Œå†™èµ·æ¥æ›´è›‹ç–¼ã€‚æ¯”è¾ƒå¹¸è¿çš„æ˜¯ï¼Œ`Swift 4.1` èƒ½å¤Ÿè‡ªåŠ¨åˆæˆ `Equatable` åè®®ä¸­çº¦å®šçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è‡ªåŠ¨ç”Ÿæˆ `==`æ–¹æ³•ï¼Œæ–¹æ³•ä¸­ä¼šæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡é—´çš„æ‰€æœ‰å±æ€§æ˜¯å¦ç›¸ç­‰ã€‚ç°åœ¨ä½ åªéœ€è¦åœ¨æŒ‡å®šçš„ç±»å‹ä¸Šæ·»åŠ éµå®ˆ `Equatable` åè®®ï¼Œå…¶ä»–çš„æ“ä½œ `Swift` ä¼šè‡ªåŠ¨å®Œæˆã€‚

å½“ç„¶ï¼Œå¦‚æœä½ æƒ³ä½ ä¹Ÿå¯ä»¥è‡ªå·±å®ç° `==` ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ç±»å‹æœ‰ä¸€ä¸ªæ ‡è®°æ˜¯å¦å”¯ä¸€çš„ `id`ï¼Œä½ éœ€è¦è‡ªå·±å†™ `==` æ¥åªæ¯”è¾ƒè¿™ä¸ªå€¼ï¼Œè€Œä¸æ˜¯è®© `Swift` æ¥å®Œæˆæ‰€æœ‰å…¶ä»–çš„å·¥ä½œã€‚

`Swift 4.1` ä¹Ÿç»™ `Hashable` åè®®æä¾›äº†è‡ªåŠ¨åˆæˆçš„æ”¯æŒï¼Œæ„å‘³ç€ä¼šè‡ªåŠ¨åˆæˆ `hashValue` å±æ€§ã€‚`Hashable` é€šå¸¸æƒ…å†µä¸‹å®ç°æ¯”è¾ƒè›‹ç–¼ï¼Œå› ä¸ºéœ€è¦è¿”å›ä¸€ä¸ªå”¯ä¸€çš„ï¼ˆæˆ–è€…å¤§å¤šæ•°æƒ…å†µä¸‹å”¯ä¸€çš„ï¼‰`hash` å€¼ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒå¯ä»¥ä½¿å¯¹è±¡ä½œä¸ºå­—å…¸çš„ `keys`å¹¶ä¸”å­˜å‚¨åœ¨ `Set`ä¸­ã€‚
```swift
// Swift 4.0 å®ç°
struct Person: Hashable {
    var name: String
    var hashValue: Int {
        return name.hashValue
    }

    static func ==(lhs: HashPerson, rhs: HashPerson) -> Bool {
        return lhs.name == rhs.name
    }
}
```
```swift
// Swift 4.1 å®ç°
struct Person: Hashable {
    var name: String
}
````
è™½ç„¶å¤§å¤šæ•°æƒ…å†µä¸‹ä¸ç”¨è‡ªå·±å®ç°ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³åšäº›ç‰¹åˆ«çš„äº‹æƒ…çš„æ—¶å€™ä¹Ÿå¯ä»¥è‡ªå·±å®ç°ã€‚

æ³¨ï¼šç°åœ¨æˆ‘ä»¬ä»ç„¶éœ€è¦è®©ç±»å‹éµå®ˆåè®®ï¼Œè‡ªåŠ¨åˆæˆéœ€è¦ç±»å‹çš„æ‰€æœ‰å±æ€§éƒ½åˆ†åˆ«éµå®ˆäº† `Equatable` æˆ–è€… `Hashable` åè®®ã€‚

æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚ç…§ [Swift Evolution proposal SE-0185](https://github.com/apple/swift-evolution/blob/master/proposals/0185-synthesize-equatable-hashable.md)

#### ä¸‰ã€Codable Key ç¼–è§£ç ç­–ç•¥ä¼˜åŒ–

*   ä¹‹å‰å†™è¿‡ä¸€ç¯‡å®Œæ•´çš„æ–‡ç« æ¥æè¿°è¿™ä¸ªç‰¹æ€§ï¼š[Swift 4.1 improves Codable with keyDecodingStrategy](https://www.hackingwithswift.com/articles/52/swift-4-1-improves-codable-with-keydecodingstrategy)

åœ¨ Swift 4.0 ä¸­ä½¿ç”¨ `Codable` åè®®ä¸€ä¸ªå¸¸è§é—®é¢˜å°±æ˜¯ï¼Œ`JSON` ä¸­ä½¿ç”¨è›‡å½¢å‘½åæ³•ä½œä¸º `key` çš„åå­—ï¼Œè€Œ `Swift` ä¸­ä½¿ç”¨é©¼å³°å‘½åæ³•ã€‚`Codable` ä¸èƒ½å¤Ÿç†è§£ä¸¤ç§å‘½åçš„å·®åˆ«ï¼Œå¿…é¡»åˆ›å»ºè‡ªå®šä¹‰çš„ `CodingKeys` æšä¸¾æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

åŸºäºä¸Šé¢çš„åŸå› ï¼ŒSwift 4.1 ä¸­å¼•å…¥äº† `keyDecodingStrategy` å±æ€§ã€‚é»˜è®¤ä¸º `.useDefaultKeys` ï¼Œç›´æ¥æ˜ å°„ `JSON` åå­—åˆ°`Swift`å±æ€§ã€‚å¯ä»¥ä½¿ç”¨ `.convertFromSnakeCase` æ¥è®© `Codable` å¤„ç†åå­—è½¬æ¢ã€‚
```swift
let decoder = JSONDecoder()

do {
    decoder.keyDecodingStrategy = .convertFromSnakeCase
    let macs = try decoder.decode([Mac].self, from: jsonData)
    print(macs)
} catch {
    print(error.localizedDescription)
}
```
åä¹‹ï¼Œå¦‚æœä½ æƒ³å°†éµå®ˆ `Codable` åè®®çš„ `struct` ç±»å‹è½¬æˆ `JSON`ï¼Œ`Struct` çš„å±æ€§æ˜¯é©¼å³°å‘½åçš„ï¼Œè½¬æˆçš„`JSON`æ˜¯è›‡å½¢å‘½åçš„ï¼Œè®¾ç½® `keyEncodingStrategy` ä¸º `.convertToSnakeCase`ã€‚
```swift
let encoder = JSONEncoder()
encoder.keyEncodingStrategy = .convertToSnakeCase
let encoded = try encoder.encode(someObject)
```
#### å››ã€åè®®çš„æ¡ä»¶éµå®ˆ

`Swift 4.1` å®ç°äº† [SE-0143](https://github.com/apple/swift-evolution/blob/master/proposals/0143-conditional-conformances.md) ææ¡ˆï¼Œå¼•å…¥äº†æ¡ä»¶éµå®ˆåè®®ã€‚å…·ä½“ä¸ºåªæœ‰å½“æ»¡è¶³æŒ‡å®šæ¡ä»¶çš„æ—¶å€™ï¼Œç±»å‹æ‰èƒ½éµå®ˆåè®®ã€‚

ä¸¾ä¾‹æ¥è®²ï¼Œæˆ‘ä»¬ç°åœ¨å£°æ˜ä¸€ä¸ªå¯ä»¥ç”¨æ¥ä¹°ä¸œè¥¿çš„åè®® `Purchaseable` ã€‚
```swift
protocol Purchaseable {
   func buy()
}
```
ç°åœ¨å¯ä»¥å®šä¹‰ä¸€ä¸ª `Book` ç»“æ„ä½“ï¼Œéµå®ˆ `Purchaseable`åè®®ï¼Œåœ¨ä¹°ä¸€æœ¬ä¹¦çš„æ—¶å€™æ‰“å°æ¶ˆæ¯ã€‚
```swift
struct Book: Purchaseable {
   func buy() {
      print("You bought a book")
   }
}
```
è¿™ä¸ªåœºæ™¯å¾ˆç®€å•ï¼Œè®©æˆ‘ä»¬æ›´è¿›ä¸€æ­¥ã€‚å¦‚æœè¿™ä¸ªç”¨æˆ·æœ‰ä¸€ä¸ªè£…æ»¡ä¹¦ç±çš„ç¯®å­ï¼Œå¹¶ä¸”æƒ³æŠŠç¯®å­é‡Œæ‰€æœ‰çš„ä¹¦å…¨éƒ½ä¹°ä¸‹æ¥ã€‚æˆ‘ä»¬å½“ç„¶å¯ä»¥éå†æ•°ç»„ï¼Œç„¶åè°ƒç”¨æ¯æœ¬ä¹¦çš„ `buy` æ–¹æ³•ã€‚ä½†æ˜¯æ›´å¥½çš„æ–¹å¼æ˜¯ç»™ `Array` å†™ä¸ª `Extension` éµå®ˆ `Purchaseable` åè®®ï¼Œç„¶åå®ç°åè®® `buy` æ–¹æ³•ï¼Œè°ƒç”¨æ¯ä¸ª `Element` çš„ `buy` æ–¹æ³•ã€‚

åŸºäºä¸Šé¢çš„åŸå› ï¼Œ`Swift 4.1` å¼•å…¥äº† `Conditional Conformances`ã€‚å¦‚æœæˆ‘ä»¬å°è¯•æ‹“å±•æ•°ç»„ï¼Œä¼šæœ‰ä¸€å®šçš„å‰¯ä½œç”¨ã€‚ä¾‹å¦‚ä¼šç»™ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„æ·»åŠ  `buy` æ–¹æ³•ï¼Œè€Œå­—ç¬¦ä¸²æ²¡æœ‰ `buy` æ–¹æ³•ä¾›æˆ‘ä»¬è°ƒç”¨ã€‚

`Swift 4.1` å¯ä»¥å®ç°åªæœ‰å½“æ•°ç»„ä¸­çš„å…ƒç´ æ˜¯éµå®ˆ `Purchaseable`ï¼Œæ•°ç»„æ‰èƒ½éµå®ˆ `Purchaseable` åè®®ã€‚
```swift
extension Array: Purchaseable where Element: Purchaseable {
   func buy() {
      for item in self {
         item.buy()
      }
   }
}
```
å¦‚ä½ æ‰€è§ï¼Œåè®®çš„æ¡ä»¶éµå®ˆï¼Œè®©æˆ‘ä»¬ä»¥æ›´ç®€æ´çš„æ–¹å¼ç»™æ‹“å±•æ·»åŠ åè®®æ”¯æŒã€‚

åŒæ ·çš„ï¼Œåè®®çš„æ¡ä»¶éµå®ˆä¹Ÿä½¿æˆ‘ä»¬çš„ `swift` ä»£ç æ›´åŠ ç®€å•å’Œå®‰å…¨ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿä¸éœ€è¦åšäº›é¢å¤–çš„å·¥ä½œã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¸¤ä¸ªå¯é€‰å­—ç¬¦ä¸²çš„æ•°ç»„å¹¶ä¸”æ¯”è¾ƒå®ƒä»¬æ˜¯å¦ç›¸ç­‰ã€‚
```swift
ar left: [String?] = ["Andrew", "Lizzie", "Sophie"]
var right: [String?] = ["Charlotte", "Paul", "John"]
left == right
```
ä¸Šé¢çš„ä¾‹å­çœ‹èµ·æ¥ä¸é‚£ä¹ˆé‡è¦ï¼Œä½†æ˜¯ `Swift 4.0` ä¸Šé¢çš„è¯­æ³•ä¸èƒ½ç¼–è¯‘ï¼Œ`String` å’Œ `[String]` æ˜¯ `Equatable`ï¼Œä½†æ˜¯ `[String?]` ä¸æ˜¯ã€‚

`Swift 4.1` ä¸­çš„åè®®çš„æ¡ä»¶çº¦æŸæŒ‡çš„æ˜¯åªè¦æ»¡è¶³æŒ‡å®šçš„æ¡ä»¶ï¼Œå°±å¯ä»¥éµå®ˆåè®®ã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæ•°ç»„ä¸­çš„å…ƒç´ æ˜¯éµå®ˆ `Equatble` çš„ï¼Œé‚£ä¹ˆæ•°ç»„å°±æ˜¯éµå®ˆ `Equatable` åè®®ã€‚æ‰€ä»¥ï¼Œä¸Šé¢çš„ä»£ç åœ¨ `Swift 4.1` ä¸Šå¯ä»¥ç¼–è¯‘é€šè¿‡ã€‚

åè®®çš„æ¡ä»¶éµå®ˆä¹Ÿé€‚ç”¨äº `Codable` åè®®ï¼Œå¹¶ä¸”ä½¿ä»£ç å˜å¾—æ›´åŠ å®‰å…¨ã€‚
```swift
import Foundation

struct Person {
   var name = "Taylor"
}

var people = [Person()]
var encoder = JSONEncoder()
// try encoder.encode(people)
```
å¦‚æœå°† `encoder.encode(people)` çš„æ³¨é‡Šæ‰“å¼€ï¼Œåœ¨ `Swift 4.1` ä¸­ç¼–è¯‘ä¸é€šè¿‡ï¼Œå› ä¸ºè¯•å›¾ `encode` ä¸€ä¸ªä¸éµå®ˆ `Codable` åè®®çš„ç±»å‹ã€‚ç„¶è€Œï¼Œè¿™æ®µä»£ç åœ¨ `Swift 4.0` ä¸Šé¢æ˜¯å¯ä»¥ç¼–è¯‘é€šè¿‡çš„ï¼Œä½†æ˜¯å› ä¸º `Person` ä¸éµå®ˆ `Codable` åè®®ä¼šå¯¼è‡´åœ¨è¿è¡Œæ—¶å´©æºƒã€‚

å¾ˆæ˜æ˜¾ï¼Œå¤§å®¶éƒ½ä¸æƒ³è¦è¿è¡Œæ—¶å´©æºƒã€‚å¹¸è¿çš„æ˜¯ï¼Œ`Swift 4.1` ä½¿ç”¨åè®®çš„æ¡ä»¶éµå®ˆå¸®æˆ‘ä»¬æ¸…é™¤äº†è¿™ä¸ªéšœç¢ï¼Œ`Optional`ã€`Array`ã€`Dictionary` å’Œ `Set` åªæœ‰åœ¨ä»–ä»¬çš„å†…å®¹éµå®ˆ `Codable` åè®®çš„æ—¶å€™ï¼Œè‡ªèº«æ‰éµå®ˆåè®®ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç åœ¨ `Swift 4.1` ä¼šç¼–è¯‘ä¸è¿‡ã€‚

#### äº”ã€å…³è”ç±»å‹çš„é€’å½’çº¦æŸ

`Swift 4.1` å®ç°äº† [SE-0157](https://github.com/apple/swift-evolution/blob/master/proposals/0157-recursive-protocol-constraints.md) ææ¡ˆï¼Œå¢å¼ºäº†åè®®å†…éƒ¨ä½¿ç”¨å…³è”ç±»å‹çš„é™åˆ¶ã€‚ç°åœ¨å¯ä»¥ç»™å…³è”ç±»å‹åˆ›å»ºä¸€ä¸ªé€’å½’çš„çº¦æŸï¼Œå°±æ˜¯å…³è”ç±»å‹å¯ä»¥ç”¨è‡ªèº«æ‰€åœ¨åè®®æ¥çº¦æŸè‡ªå·±ã€‚

æˆ‘ä»¬ä»¥æŠ€æœ¯å…¬å¸çš„ç®¡ç†å±‚çº§æ¥é˜è¿°è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ä¸€ä¸ªå…¬å¸ï¼Œæ¯ä¸€ä¸ªé›‡å‘˜éƒ½æœ‰ä¸€ä¸ªä¸Šå¸ï¼Œæ¯ä¸ªä¸Šå¸å¿…é¡»æœ‰ä¸€ä¸ªä»¥ä¸Šçš„ä¸‹å±ã€‚æˆ‘ä»¬ä»¥ä¸€ä¸ª `Employee` åè®®æ¥è¡¨æ˜è¿™æ ·çš„å…³ç³»ï¼š
```swift
protocol Employee {
   associatedtype Manager: Employee
   var manager: Manager? { get set }
}
```
å°½ç®¡è¿™æ˜¯ä¸€ä¸ªä¸è¨€è€Œå–»çš„å…³ç³»ï¼Œä½†æ˜¯ `Swift 4.0` ä¸Šè¿™æ®µä»£ç å´ç¼–è¯‘ä¸è¿‡ï¼Œå› ä¸ºåœ¨åè®®å†…éƒ¨ä½¿ç”¨äº†è‡ªå·±ã€‚

æ„Ÿè°¢è¿™ä¸ªæ–°ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸ªåŒ…å«ä¸‰ç§å›¢é˜Ÿè§’è‰²çš„æŠ€æœ¯å…¬å¸ï¼Œåˆçº§å¼€å‘å·¥ç¨‹å¸ˆã€é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆå’Œè‘£äº‹ä¼šæˆå‘˜ã€‚
```swift
class BoardMember: Employee {
   var manager: BoardMember?
}

class SeniorDeveloper: Employee {
   var manager: BoardMember?
}

class JuniorDeveloper: Employee {
   var manager: SeniorDeveloper?
}
```
æ³¨ï¼šè¿™è¾¹ç”¨ `Class` è€Œä¸æ˜¯ `Struct`ï¼Œæ˜¯å› ä¸º `BoardMember` é‡Œé¢åŒ…å«ä¸€ä¸ª `BoardMember`ï¼Œå¦‚æœç”¨ç»“æ„ä½“ä¼šå½¢æˆæ— ç©·å¤§çš„ç»“æ„ä½“ã€‚å¦‚æœè¿™é‡Œé¢æœ‰ä¸€ä¸ª `Class` ï¼Œæˆ‘ä¸ªäººå€¾å‘äºä½¿ç”¨å…¨éƒ¨é‡‡ç”¨ `Class` æ¥ä¿æŒä¸€è‡´ã€‚å¦‚æœä½ æƒ³è¦ä½¿ç”¨ç»“æ„ä½“ï¼Œå¯ä»¥æŠŠ `JuniorDeveloper` å’Œ `SeniorDeveloper` è®¾ç½®æˆç»“æ„ä½“ã€‚

#### å…­ã€æ¨¡å—å¼•å…¥æ£€æµ‹

`Swift 4.1` å®ç°äº† [SE-0075](https://github.com/apple/swift-evolution/blob/master/proposals/0075-import-test.md) ææ¡ˆï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°çš„ `canImport` æ¡ä»¶æ¥å¸®åŠ©æˆ‘ä»¬åœ¨ç¼–è¯‘æœŸæ£€æµ‹ä¸€ä¸ªæŒ‡å®šçš„æ¨¡å—èƒ½å¦è¢«å¯¼å…¥ã€‚

è¿™ä¸ªç‰¹æ€§å¯¹è·¨å¹³å°çš„ä»£ç å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚ä½ çš„ä»£ç åœ¨ `macOS` å’Œ `iOS` è¡Œä¸ºä¸ä¸€æ ·ï¼Œæˆ–è€…ä½ éœ€è¦ `Linux` çš„åŠŸèƒ½ã€‚
```swift
#if canImport(SpriteKit)
   // this will be true for iOS, macOS, tvOS, and watchOS
#else
   // this will be true for other platforms, such as Linux
#endif
```
ä¹‹å‰æˆ‘ä»¬å¿…é¡»é€šè¿‡åˆ¤æ–­å¹³å°ä¿¡æ¯æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚
```swift
#if !os(Linux)
   // Matches macOS, iOS, watchOS, tvOS, and any other future platforms
#endif

#if os(macOS) || os(iOS) || os(tvOS) || os(watchOS)
   // Matches only Apple platforms, but needs to be kept up to date as new platforms are added
#endif
```
æ–°ç‰¹æ€§ `canImport` è®©æˆ‘ä»¬æ›´å¥½çš„å…³æ³¨åŠŸèƒ½ï¼Œè€Œä¸æ˜¯å½“å‰ç¼–è¯‘çš„å¹³å°ï¼Œé¿å…äº†å¾ˆå¤šè›‹ç–¼çš„é—®é¢˜ã€‚

#### ä¸ƒã€æ¨¡æ‹Ÿå™¨ç¯å¢ƒæ£€æµ‹

`Swift 4.1` å®ç°äº† [SE-0190](https://github.com/apple/swift-evolution/blob/master/proposals/0190-target-environment-platform-condition.md) ææ¡ˆï¼Œå¼•å…¥äº† `targetEnvironment` æ¡ä»¶ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„åŒºåˆ†æ¨¡æ‹Ÿå™¨å’ŒçœŸæœºã€‚ç°åœ¨ `targetEnvironment` åªæœ‰ä¸€ä¸ªå€¼ `simulator`ï¼Œå½“æ˜¯æ¨¡æ‹Ÿå™¨è®¾å¤‡çš„æ—¶å€™ï¼Œè¿”å› `true`ã€‚
```swift
#if targetEnvironment(simulator)
   // code for the simulator here
#else
   // code for real devices here
#endif
```
å½“ä»£ç ç”¨æ¥å¤„ç†ç±»ä¼¼äºä»æ‘„åƒå¤´è¯»å–æ•°æ®æˆ–è€…è®¿é—®é™€èºä»ªæ•°æ®ç­‰æ¨¡æ‹Ÿå™¨ä¸æ”¯æŒçš„åŠŸèƒ½çš„æ—¶å€™ï¼Œè¿™ä¸ªæ¡ä»¶åˆ¤æ–­å¾ˆæœ‰ç”¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä»æ‘„åƒå¤´é€‰æ‹©ç…§ç‰‡ï¼Œå¦‚æœæ˜¯çœŸæœºï¼Œåˆ›å»ºå’Œé…ç½® `UIImagePickerController()`æ–¹æ³• ï¼Œå¦‚æœæ˜¯æ¨¡æ‹Ÿå™¨ï¼Œä» `Bundle` ä¸­è¯»å–ä¸€å¼ å›¾ç‰‡ã€‚
```swift
import UIKit

class TestViewController: UIViewController, UIImagePickerControllerDelegate {
   // a method that does some sort of image processing
   func processPhoto(_ img: UIImage) {
       // process photo here
   }

   // a method that loads a photo either using the camera or using a sample
   func takePhoto() {
      #if targetEnvironment(simulator)
         // we're building for the simulator; use the sample photo
         if let img = UIImage(named: "sample") {
            processPhoto(img)
         } else {
            fatalError("Sample image failed to load")
         }
      #else
         // we're building for a real device; take an actual photo
         let picker = UIImagePickerController()
         picker.sourceType = .camera
         vc.allowsEditing = true
         picker.delegate = self
         present(picker, animated: true)
      #endif
   }

   // this is called if the photo was taken successfully
   func imagePickerController(_ picker: UIImagePickerController, didFinishPickingMediaWithInfo info: [String : Any]) {
      // hide the camera
      picker.dismiss(animated: true)

      // attempt to retrieve the photo they took
      guard let image = info[UIImagePickerControllerEditedImage] as? UIImage else {
         // that failed; bail out
         return
      }

      // we have an image, so we can process it
      processPhoto(image)
   }
}
```
#### å…«ã€FlatMap éƒ¨åˆ†åœºæ™¯æ›´å CompactMap

`FlatMap` åœ¨ `Swift 4.0` ä¸­å¾ˆæœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨è½¬æ¢é›†åˆä¸­çš„å¯¹è±¡ï¼Œå¹¶ä¸”ç§»é™¤å…¶ä¸­çš„ `nil` å¯¹è±¡çš„æ—¶å€™ã€‚Swift ææ¡ˆ [SE-0187](https://github.com/apple/swift-evolution/blob/master/proposals/0187-introduce-filtermap.md) ä¸­æœ‰å¯¹è¿™éƒ¨åˆ†å†…å®¹æ›´æ”¹çš„è¯´æ˜ï¼Œåœ¨ Swift 4.1 ä¸­ `flatMap` ä¸ºäº†è¯­ä¹‰æ›´åŠ æ¸…æ™°ï¼Œå·²ç»æ›´åæˆ `compactMap`ã€‚
```swift
let array = ["1", "2", "Fish"]
let numbers = array.compactMap { Int($0) }
```
ä¸Šé¢ä¾‹å­çš„ç»“æœæ˜¯ `[1, 2]`ã€‚

#### ä¹ã€å±•æœ› Swift 5

å¼•å…¥åè®®çš„æ¡ä»¶éµå®ˆå·²ç»ä½¿ `Swift` å›¢é˜Ÿæå‡ç¨³å®šæ€§çš„åŒæ—¶ï¼Œç§»é™¤äº†å¤§é‡ä»£ç ï¼Œè‡ªåŠ¨åˆæˆ `Equatable` å’Œ `Hashable` çš„æ”¯æŒä¹Ÿä½¿æˆ‘ä»¬å¼€å‘æ›´åŠ ä¾¿æ·ã€‚å…¶ä»–ä¸€äº›åœ¨å¼€å‘æˆ–è€…åœ¨ `Review` çš„ææ¡ˆï¼ŒåŒ…æ‹¬ [SE-0192: Non-Exhaustive Enums](https://github.com/apple/swift-evolution/blob/master/proposals/0192-non-exhaustive-enums.md), [SE-0194: Derived Collection of Enum Cases](https://github.com/apple/swift-evolution/blob/master/proposals/0194-derived-collection-of-enum-cases.md),å’Œ [SE-0195: Dynamic Member Lookup](https://github.com/apple/swift-evolution/blob/master/proposals/0195-dynamic-member-lookup.md) â€“ [click here to learn more about new Swift features coming in 2018](https://www.hackingwithswift.com/articles/62/what-2018-has-in-store-for-swift)ã€‚åŒè¿™äº›æ–°ç‰¹æ€§ä¸€æ ·é‡è¦çš„æ˜¯ï¼Œè‹¹æœè®¡åˆ’åœ¨ä»Šå¹´å®ç° `Swift` çš„ `ABI` ç¨³å®šï¼ŒæœŸå¾…ğŸ™ğŸ™ğŸ™ã€‚

#### åã€æ„Ÿè°¢åŸä½œè€… `Paul Hudson`ï¼Œ[åŸæ–‡åœ°å€](https://www.hackingwithswift.com/articles/50/whats-new-in-swift-4-1)